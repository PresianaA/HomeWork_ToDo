﻿using StudentJsonTxt.Models;
using System.Collections.Generic;

namespace StudentJsonTxt.Repositories
{
    public class StudentRepositoryTxt
    {
        private readonly string _filePath;
        public StudentRepositoryTxt(string filePath = "students.txt")
        {
            _filePath = filePath;
        }

        public void Save(List<Student> students)
        {
            var lines = new List<string>();
            foreach (var s in students)
            {
                lines.Add($"{s.Name};{s.Grade}");
            }
            File.AppendAllLines(_filePath, lines);  // Дописва редове към файл
           // File.WriteAllLines(_filePath, lines); // Презаписва целия файл
        }

public class Student
{
    public string Name { get; set; }
    public double Grade { get; set; }

    public Student() { }

    public Student(string name, double grade)
    {
        Name = name;
        Grade = grade;
    }
}


      public List<Student> Load()
{
    List<Student> list = new List<Student>();

    if (!File.Exists(_filePath))
        return list;

    string[] lines = File.ReadAllLines(_filePath);

    foreach (string line in lines)
    {
        if (line.Trim().Length == 0)
            continue;

        string[] parts = line.Split(';');

        if (parts.Length < 2)
            continue;

        string name = parts[0];

        // Заменяме точка с запетая, за да може double да се парсне
        string gradeText = parts[1].Replace(".", ",");

        double grade = double.Parse(gradeText);

        Student s = new Student();
        s.Name = name;
        s.Grade = grade;

        list.Add(s);
    }

    return list;



    }
}
